
<div id="schema_reload_button" fxLayout="row wrap" fxLayoutAlign="end start">
    <button color="primary" mat-button (click)=guessSchema()>
        <i class="material-icons">
           refresh
        </i>
        <!--<span style="font-weight: bold;" > Guess Schema </span>-->
    </button>
</div>

<div fxLayout="column" *ngIf="isLoading">
    <div fxLayoutAlign="center" >
        <mat-spinner fxLayoutAlign="center" style="margin: 10px 0 5px 0" >Loading</mat-spinner>
    </div>
    <div fxLayoutAlign="center">
        <h3>The system tries to guess the schema of the data</h3>
    </div>
</div>

<div fxLayout="column" *ngIf="isError">
    <div fxLayout="row" fxLayoutAlign="center center">
        <mat-icon style="margin-top: 10px" class="md-accent">warning</mat-icon>
        <span style="width: 10px;"></span>
        <h3>System error while guess the schema of the data</h3>
    </div>
    <div fxLayout="row" fxLayoutAlign="center center" >
        <button mat-button class="md-accent">
            <div *ngIf="!showErrorMessage" (click)="showErrorMessage = true">Show Details</div>
            <div *ngIf="showErrorMessage" (click)="showErrorMessage = false">Hide Details</div>
        </button>
    </div>
    <div fxLayoutAlign="center center" *ngIf="showErrorMessage">
        <div class="error-message">
            <div *ngFor="let error of errorMessages" style="margin-bottom: 5px; margin-top: 5px">
                <div>{{error.title}}</div>
                <div>{{error.description}}</div>
            </div>
        </div>
    </div>
</div>

<div fxLayout="column" fxLayoutAlign="space-evenly stretched" class="drag-drop-tree">
    <!--
    <app-event-property-bag [(eventProperties)]="eventSchema.eventProperties" [domainPropertyGuesses]="schemaGuess.eventProperties" [isEditable]="isEditable">
    </app-event-property-bag>
    <cdk-tree #treeSelector [dataSource]="datasource" [treeControl]="treeControl" cdkDropList (cdkDropListDropped)="drop($event)">
        <cdk-tree-node style="display: flex" *cdkTreeNodeDef="let node;" cdkTreeNodePadding cdkDrag [cdkDragData]="node">
            {{node.runTimeName}} 
        </cdk-tree-node>
    </cdk-tree>
    -->

    <tree-root #tree [nodes]="nodes" [options]="options" (updateData)= "onUpdateData(tree, $event)">
        <ng-template #treeNodeTemplate let-node let-index="index">
            <div class="schema"  *ngIf="isEventPropertyNested(node.data)">
            <app-event-property-nested [index]="i + 1"
                        [eventPropertyNested]="node.data"
                        [domainPropertyGuess]="getDomainProbability(node.data.runTimeName)"
                        [domainPropertyGuesses]="domainPropertyGuesses"
                        [isEditable]="isEditable"
                        (delete)=deletePropertyNested($event)></app-event-property-nested>
            </div>
            <div *ngIf="isEventPropertyPrimitive(node.data)">
            <app-event-property-primitive (delete)=deletePropertyPrimitive($event)
                        (addPrimitive)="addStaticValueProperty($event)"
                        [domainPropertyGuess]="getDomainProbability(node.data.runTimeName)"
                        [isEditable]="isEditable"
                        [property]="node.data">
            </app-event-property-primitive>
            </div>
            <div *ngIf="isEventPropertyList(node.data)">
            <app-event-property-list (delete)=deletePropertyList($event)
                        [isEditable]="isEditable"
                        [property]="node.data">
            </app-event-property-list>
            </div>
            <div fxLayoutAlign="center center" class="addSchema" *ngIf="isNested(node.data)">
                <button [disabled]="!isEditable" color="primary" mat-button (click)=addNestedProperty(node.data)>
                  <mat-icon matTooltip="Add a Nested Property">queue</mat-icon>
                </button>
              </div>
          </ng-template>
    </tree-root>
    <div fxLayoutAlign="center center" class="addSchema">
        <button [disabled]="!isEditable" color="primary" mat-button (click)=addNestedProperty()>
          <mat-icon matTooltip="Add a Nested Property">queue</mat-icon>
        </button>
        <button [disabled]="!isEditable" *ngIf="!eventPropertyNested" color="primary" mat-button (click)="addStaticValueProperty()">
          <mat-icon matTooltip="Add a static value to event">add</mat-icon>
        </button>
        <button [disabled]="!isEditable"  *ngIf="!eventPropertyNested" color="primary" mat-button (click)=addTimestampProperty()>
          <mat-icon matTooltip="Add timestamp to event schema">access_time</mat-icon>
        </button>
      </div>
</div>


